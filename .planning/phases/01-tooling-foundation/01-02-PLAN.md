---
phase: 01-tooling-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - eslint.config.js
  - package.json
  - .husky/pre-commit
autonomous: true

must_haves:
  truths:
    - "ESLint runs on both .js and .ts files"
    - "TypeScript-specific ESLint rules are active for .ts files"
    - "Type-checked rules are disabled for .js files"
    - "Pre-commit hook runs type-check on entire project"
    - "lint-staged handles both .js and .ts files"
  artifacts:
    - path: "eslint.config.js"
      provides: "TypeScript-aware ESLint configuration"
      contains: "typescript-eslint"
    - path: ".husky/pre-commit"
      provides: "Pre-commit hook with type-checking"
      contains: "typecheck"
  key_links:
    - from: "eslint.config.js"
      to: "tsconfig.json"
      via: "parserOptions.projectService reads tsconfig"
      pattern: "projectService.*true"
    - from: ".husky/pre-commit"
      to: "package.json"
      via: "npm run typecheck"
      pattern: "npm run typecheck"
---

<objective>
Integrate TypeScript support into ESLint and configure lint-staged for TypeScript files.

Purpose: Enable type-aware linting for TypeScript files while keeping JavaScript linting unchanged. Ensure pre-commit hooks catch type errors across the entire project.

Output: Updated eslint.config.js with typescript-eslint integration, lint-staged configured for .ts files, pre-commit hook includes type-checking.
</objective>

<execution_context>
@/Users/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-tooling-foundation/01-RESEARCH.md
@.planning/phases/01-tooling-foundation/01-01-SUMMARY.md
@eslint.config.js
@tsconfig.json
@.husky/pre-commit
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ESLint config for TypeScript</name>
  <files>eslint.config.js</files>
  <action>
Update eslint.config.js to integrate typescript-eslint. Use the modern approach from RESEARCH.md:

```javascript
// ESLint flat config for ESLint v9+ with TypeScript support
import eslint from "@eslint/js";
import { defineConfig } from "eslint/config";
import tseslint from "typescript-eslint";

export default defineConfig(
  eslint.configs.recommended,
  tseslint.configs.recommended,
  {
    languageOptions: {
      ecmaVersion: "latest",
      sourceType: "module",
      globals: {
        // Node.js globals
        __dirname: "readonly",
        __filename: "readonly",
        Buffer: "readonly",
        console: "readonly",
        exports: "writable",
        global: "readonly",
        module: "readonly",
        process: "readonly",
        require: "readonly",
        setTimeout: "readonly",
        clearTimeout: "readonly",
        setInterval: "readonly",
        clearInterval: "readonly",
      },
    },
    rules: {
      // Style rules matching existing conventions
      indent: ["error", 2],
      quotes: ["error", "double", { avoidEscape: true }],
      semi: ["error", "always"],
      "comma-dangle": ["error", "always-multiline"],

      // Best practices
      "no-console": "off",
      "prefer-const": "warn",
      "no-var": "error",

      // ES6+
      "arrow-spacing": "error",
      "template-curly-spacing": "error",
      "object-shorthand": "warn",

      // Potential errors
      "no-undef": "error",
      "no-unreachable": "error",

      // TypeScript-specific: use TS rule instead of base
      "no-unused-vars": "off",
      "@typescript-eslint/no-unused-vars": ["warn", { argsIgnorePattern: "^_" }],
    },
  },
  {
    // TypeScript files: enable type-checked rules
    files: ["**/*.ts"],
    languageOptions: {
      parserOptions: {
        projectService: true,
        tsconfigRootDir: import.meta.dirname,
      },
    },
  },
  {
    // JavaScript files: disable type-checked rules
    files: ["**/*.js"],
    extends: [tseslint.configs.disableTypeChecked],
  },
  {
    // Frontend files use browser globals
    files: ["public/**/*.js"],
    languageOptions: {
      sourceType: "script",
      globals: {
        // Browser globals
        window: "readonly",
        document: "readonly",
        console: "readonly",
        setTimeout: "readonly",
        clearTimeout: "readonly",
        setInterval: "readonly",
        clearInterval: "readonly",
        requestAnimationFrame: "readonly",
        cancelAnimationFrame: "readonly",
        getComputedStyle: "readonly",
        alert: "readonly",
        confirm: "readonly",
        prompt: "readonly",
        Blob: "readonly",
        URL: "readonly",
        FileReader: "readonly",
        // Socket.io client
        io: "readonly",
        // Toast notification system
        toast: "readonly",
      },
    },
  },
  {
    // Test files
    files: ["test/**/*.{js,ts}", "vitest.config.js", "eslint.config.js"],
    languageOptions: {
      sourceType: "module",
      globals: {
        // Vitest globals
        describe: "readonly",
        it: "readonly",
        expect: "readonly",
        beforeAll: "readonly",
        afterAll: "readonly",
        beforeEach: "readonly",
        afterEach: "readonly",
        // Node.js globals
        __dirname: "readonly",
        __filename: "readonly",
        Buffer: "readonly",
        console: "readonly",
        process: "readonly",
      },
    },
  },
  {
    ignores: [
      "node_modules/",
      "coverage/",
      "dist/",
      "*.min.js",
      "public/toast.js",
    ],
  },
);
```

Key changes from current config:
- Add `import { defineConfig } from "eslint/config"` and `import tseslint from "typescript-eslint"`
- Wrap export in `defineConfig()` (per RESEARCH.md - don't use deprecated tseslint.config())
- Add `tseslint.configs.recommended` to extends
- Add TypeScript file block with `projectService: true` for type-aware rules
- Add JavaScript file block with `tseslint.configs.disableTypeChecked`
- Replace `no-unused-vars` with `@typescript-eslint/no-unused-vars`
- Add `dist/` to ignores
- Update test files pattern to include .ts
  </action>
  <verify>
Run these commands:
1. `npm run lint` - should complete without errors on all existing JS files
2. Create a temp test: `echo "const x: string = 'test';" > temp.ts && npm run lint temp.ts && rm temp.ts` - should lint the TS file
  </verify>
  <done>ESLint configured with typescript-eslint, type-checked rules for .ts files, type-checked rules disabled for .js files</done>
</task>

<task type="auto">
  <name>Task 2: Update lint-staged and pre-commit hook</name>
  <files>package.json, .husky/pre-commit</files>
  <action>
Update lint-staged in package.json to handle both JS and TS files:

```json
{
  "lint-staged": {
    "*.{js,ts}": [
      "eslint --fix"
    ]
  }
}
```

Update .husky/pre-commit to include project-wide type-checking:

```bash
npx lint-staged
npm run typecheck
npm test
```

Why project-wide typecheck (from RESEARCH.md pitfall #2):
- If you change types in file A, file B might break
- Only checking staged files would miss cross-file type errors
- CI would catch what pre-commit missed - bad DX
- Running full `tsc --noEmit` is fast enough for this project size

Order matters:
1. lint-staged first - fast, fixes auto-fixable issues
2. typecheck second - catches type errors across whole project
3. tests last - validates functionality
  </action>
  <verify>
Test the pre-commit hook:
1. `git stash` (save any uncommitted changes)
2. `echo "// test" >> server.js` (make a small change)
3. `git add server.js`
4. `git commit -m "test: verify pre-commit hook"` - should run lint-staged, typecheck, and tests
5. `git reset HEAD~1` (undo the test commit)
6. `git checkout server.js` (restore file)
7. `git stash pop` (restore any stashed changes)
  </verify>
  <done>lint-staged handles .js and .ts files, pre-commit runs project-wide type-check</done>
</task>

</tasks>

<verification>
After all tasks complete, verify Phase 1 is fully complete:

1. **ESLint works on JS:** `npm run lint` passes on existing codebase
2. **ESLint works on TS:** Create temp .ts file and lint it
3. **Pre-commit runs typecheck:** Make a commit and verify typecheck runs
4. **All phase success criteria met:**
   - `npm run typecheck` runs without errors
   - `npm run dev` starts server with tsx
   - `npm run build` produces working executable
   - All existing tests pass
   - lint-staged handles TypeScript files
</verification>

<success_criteria>
- [ ] eslint.config.js imports typescript-eslint
- [ ] ESLint runs successfully on existing JS files
- [ ] ESLint can lint .ts files with type-aware rules
- [ ] lint-staged configured for *.{js,ts}
- [ ] Pre-commit hook includes npm run typecheck
- [ ] Full pre-commit flow works (lint -> typecheck -> test)
</success_criteria>

<output>
After completion, create `.planning/phases/01-tooling-foundation/01-02-SUMMARY.md`
</output>
