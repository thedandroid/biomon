---
phase: 04-server-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - createServer.ts
autonomous: true

must_haves:
  truths:
    - "createServer.ts exports typed server factory function"
    - "TypedServer generic applied to Socket.io Server instance"
    - "Integration tests pass with typed createServer import"
    - "npm run typecheck passes with no errors"
  artifacts:
    - path: "createServer.ts"
      provides: "Typed Express + Socket.io server factory"
      exports: ["createServer", "ServerOptions", "ServerInstance"]
      min_lines: 35
  key_links:
    - from: "createServer.ts"
      to: "src/types/events.ts"
      via: "import type { TypedServer }"
      pattern: "import type.*TypedServer.*from.*src/types"
    - from: "server.js"
      to: "createServer.ts"
      via: "ESM import with .js extension"
      pattern: "import.*createServer.*from.*createServer\\.js"
---

<objective>
Convert createServer.js to TypeScript with fully typed Socket.io Server generics

Purpose: Establish typed server factory as foundation for server.js migration (Phase 5). The factory pattern enables both production server and integration tests to share the same typed server creation logic.

Output: createServer.ts with explicit ServerOptions input type, ServerInstance return type, and TypedServer applied to Socket.io instance
</objective>

<execution_context>
@/Users/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-server-infrastructure/04-RESEARCH.md

# Prior work
@.planning/phases/02-type-definitions/02-01-SUMMARY.md
@src/types/events.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert createServer.js to createServer.ts</name>
  <files>createServer.ts, createServer.js (delete)</files>
  <action>
Convert the server factory to TypeScript:

1. Create `createServer.ts` with the following structure:

   **Imports:**
   ```typescript
   import express, { type Express } from "express";
   import { createServer as createHTTPServer, type Server as HTTPServer } from "http";
   import { Server } from "socket.io";
   import type { TypedServer } from "./src/types/index.js";
   ```

   **Interface definitions:**
   ```typescript
   export interface ServerOptions {
     corsOrigin?: string | string[];
   }

   export interface ServerInstance {
     app: Express;
     server: HTTPServer;
     io: TypedServer;
   }
   ```

   **Function implementation:**
   - Keep exact same logic as JS version
   - Add explicit parameter type: `options: ServerOptions = {}`
   - Add explicit return type: `: ServerInstance`
   - Type the `io` variable: `const io: TypedServer = new Server(...)`
   - Type `corsOrigin` variable: `let corsOrigin: string | string[] = ...`

   **Preserve existing behavior:**
   - CORS origin parsing (string with commas -> array)
   - Default origin "http://localhost:3051"
   - Return object `{ app, server, io }`

2. Delete `createServer.js` after TypeScript version is verified working

3. Verify imports still work (server.js and tests use `.js` extension which resolves to `.ts` via Bundler mode)
  </action>
  <verify>
- `npm run typecheck` passes with no errors
- `npm test` passes (integration tests import createServer)
- `npm run lint` passes
  </verify>
  <done>
- createServer.ts exists with ServerOptions and ServerInstance interfaces exported
- createServer.js deleted
- TypedServer generic applied to Socket.io Server instance
- All tests pass
  </done>
</task>

</tasks>

<verification>
Run all checks:
```bash
npm run typecheck && npm run lint && npm test
```

All must pass for phase completion.
</verification>

<success_criteria>
1. createServer.ts compiles with typed Socket.io Server and Socket generics
2. Integration tests pass with typed server infrastructure
3. Express types properly inferred from return type
4. No `any` types in createServer.ts
</success_criteria>

<output>
After completion, create `.planning/phases/04-server-infrastructure/04-01-SUMMARY.md`
</output>
