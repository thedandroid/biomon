# Milestone v1.0: BIOMON TypeScript Migration

**Status:** SHIPPED 2026-01-28
**Phases:** 1-6
**Total Plans:** 12

## Overview

This roadmap transformed the BIOMON server from JavaScript to TypeScript with strict mode, converting ~1,300 lines of server-side code across 4 files into a typed, modular codebase. The migration followed a bottom-up approach: tooling and types first, then utilities, infrastructure, handlers, and finally tests. Each phase built on the previous, ensuring no `any` type leakage at module boundaries.

## Phases

### Phase 1: Tooling Foundation
**Goal**: Establish TypeScript infrastructure without converting any source files
**Depends on**: Nothing (first phase)
**Requirements**: TS-BUILD (Update build process to compile TypeScript), TS-ESLINT (Update ESLint config for TypeScript)
**Success Criteria**:
  1. `npm run typecheck` runs without errors (on empty project)
  2. `npm run dev` starts development server with TypeScript support
  3. `npm run build` produces working executable
  4. All existing tests pass unchanged
  5. lint-staged handles TypeScript files
**Plans**: 2 plans

Plans:
- [x] 01-01-PLAN.md — Install TypeScript deps, create tsconfig.json, update scripts
- [x] 01-02-PLAN.md — Integrate typescript-eslint and update lint-staged

### Phase 2: Type Definitions
**Goal**: Create central type definitions that serve as contracts between modules
**Depends on**: Phase 1
**Requirements**: TS-TYPES (Define shared types for state, players, effects, events)
**Success Criteria**:
  1. Type files compile without errors via `npm run typecheck`
  2. All types exported and importable from src/types/
  3. No runtime code in type files (pure type definitions)
  4. Socket.io event maps defined with full payload shapes
**Plans**: 1 plan

Plans:
- [x] 02-01-PLAN.md — Create state types, event maps, table types, and barrel export in src/types/

### Phase 3: Pure Data & Utilities
**Goal**: Convert pure functions and data modules to TypeScript
**Depends on**: Phase 2
**Requirements**: TS-UTILS (Convert utils.js to TypeScript), TS-TABLES (Convert responseTables.js to TypeScript)
**Success Criteria**:
  1. utils.ts compiles with full type coverage (no `any`)
  2. responseTables.ts compiles with typed table entries and const assertions
  3. Existing tests import and pass with typed modules
  4. Functions have explicit parameter and return types
**Plans**: 1 plan

Plans:
- [x] 03-01-PLAN.md — Convert utils.js and responseTables.js to TypeScript with type annotations

### Phase 4: Server Infrastructure
**Goal**: Convert server factory to TypeScript with typed Socket.io generics
**Depends on**: Phase 3
**Requirements**: TS-CREATE-SERVER (Convert createServer.js to TypeScript)
**Success Criteria**:
  1. createServer.ts compiles with typed Socket.io Server and Socket generics
  2. Integration tests pass with typed server infrastructure
  3. Express types properly inferred from ServerInstance return type
  4. No `any` types in createServer.ts
**Plans**: 1 plan

Plans:
- [x] 04-01-PLAN.md — Convert createServer.js to TypeScript with typed Socket.io generics

### Phase 5: Event Handler Migration
**Goal**: Extract and type all Socket.io event handlers from monolithic server.js
**Depends on**: Phase 4
**Requirements**: TS-SERVER (Convert server.js to TypeScript with strict mode)
**Success Criteria**:
  1. All 18 event handlers typed with full payload shapes
  2. Discriminated unions used for roll types (stress vs panic)
  3. All runtime validation preserved (53+ optional chaining sites)
  4. server.ts refactored to thin router (~200 LOC entry point)
  5. All existing tests pass
**Plans**: 4 plans

Plans:
- [x] 05-01-PLAN.md — Handler infrastructure + player/party handlers (4 events)
- [x] 05-02-PLAN.md — Roll handlers with discriminated unions (5 events)
- [x] 05-03-PLAN.md — Effect, condition, session, external handlers (9 events)
- [x] 05-04-PLAN.md — Server.ts thin router with handler registration

### Phase 6: Test Migration & Validation
**Goal**: Convert test files to TypeScript and validate complete migration
**Depends on**: Phase 5
**Requirements**: TS-TESTS (All tests pass after migration)
**Success Criteria**:
  1. All test files converted to TypeScript
  2. Full type coverage in tests (no `any`)
  3. pkg executable works correctly (build produces working binary)
  4. External integration tests pass
  5. No regression in functionality (all 79 existing tests pass)
**Plans**: 3 plans

Plans:
- [x] 06-01-PLAN.md — Migrate unit tests (utils, responseTables, selfcheck) to TypeScript
- [x] 06-02-PLAN.md — Migrate server integration tests with typed Socket.IO clients
- [x] 06-03-PLAN.md — Migrate external integration tests, update config, final validation

## Progress

**Execution Order:** Phases execute in numeric order: 1 -> 2 -> 3 -> 4 -> 5 -> 6

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 1. Tooling Foundation | 2/2 | Complete | 2026-01-27 |
| 2. Type Definitions | 1/1 | Complete | 2026-01-27 |
| 3. Pure Data & Utilities | 1/1 | Complete | 2026-01-28 |
| 4. Server Infrastructure | 1/1 | Complete | 2026-01-28 |
| 5. Event Handler Migration | 4/4 | Complete | 2026-01-28 |
| 6. Test Migration & Validation | 3/3 | Complete | 2026-01-28 |

---

## Milestone Summary

**Key Decisions:**
- TypeScript as type-checker only (esbuild transpiles)
- strict: true from day one
- moduleResolution: "Bundler" for optimal esbuild integration
- Keep all runtime validation (types are compile-time only)
- allowJs: true, checkJs: false for JS/TS transition
- Thin router pattern for server.ts (412 LOC vs original 887 LOC)
- Keep persistence inline in server.ts
- TypedClientSocket alias for test clients

**Issues Resolved:**
- All 8 Active requirements from PROJECT.md satisfied
- All 8 Validated requirements continue working
- 79 tests passing with TypeScript test files

**Technical Debt Incurred:**
- eslint-disable for `any` on table entry return types in handlers/types.ts (documented decision)
- Unused ApplyOption import in src/types/tables.ts (lint warning only)
- pkg cross-compilation fails on macOS for Windows target (platform limitation)

---

_For current project status, see .planning/MILESTONES.md_
